<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flutter Web Message Example</title>
</head>
<body>

  <h1>Send Message to Flutter App</h1>
  <button id="sendMessageButton">Send Message to Flutter</button>

  <script>
    document.getElementById('sendMessageButton').addEventListener('click', function() {
      console.log("Button clicked");

      var cacheBuster = new Date().getTime();

      // Retrieve variables from local storage or set default values
      var accessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjMDE1ZGQyYi0wMGFiLTQ0MDQtODM4Yy0yYzdhYWI4MWQzNGIiLCJpYXQiOjE3MjYyMzYxMjAsImV4cCI6MTcyODgyODEyMH0.HOTCyQlLj2pAk3Fcen7CDGF6n9XJZRal7hcvmIO_X3w";
      var refreshToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjMDE1ZGQyYi0wMGFiLTQ0MDQtODM4Yy0yYzdhYWI4MWQzNGIiLCJpYXQiOjE3MjYyMzYxMjAsImV4cCI6MTc4OTMwODEyMH0.jREp4q6hnuldA9h4TEhYqUKxEaReqmUxtyQtrJe9ppc";
      var userId = "c015dd2b-00ab-4404-838c-2c7aab81d34b";

      // Open a new window and load Flutter web app
      var newWindow = window.open('https://pinky-promise-web-staging.web.app?source=myglamm', '_blank');

      // Poll until the new window is fully loaded and then send the message
      var sendMessage = function() {
        if (newWindow) {
          console.log("Sending message to the new Flutter window...");

          newWindow.postMessage({
            action: 'external_embed',
            accessToken: accessToken,
            refreshToken: refreshToken,
            userId: userId,
          }, 'https://pinky-promise-web-staging.web.app?source=myglamm');
        } else {
          console.error("Failed to open the new window.");
        }
      };

      // Use a delay to ensure the new window has time to load
      setTimeout(sendMessage, 1000);  // Adjust delay if necessary
    });
  </script>

</body>
</html>
